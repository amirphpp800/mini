<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Countries Glass Cards</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;600&family=Vazirmatn:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="public/styles.css" />
</head>
<body>
  <canvas id="bg-net"></canvas>
  <header>
    <h1>Countries Showcase</h1>
    <div class="actions">
      <a href="public/admin.html" class="admin-btn"><span class="btn-ico" aria-hidden="true">
        <!-- Lucide settings cog icon -->
        <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="#f6c454" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 9a3 3 0 1 0 0 6 3 3 0 0 0 0-6"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 1 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9c.7 0 1.27.3 1.51 1H21a2 2 0 1 1 0 4h-.09c-.24.7-.81 1-1.51 1Z"/></svg>
      </span>Admin Panel</a>
      <button id="openSignup" class="primary-btn accent-btn"><span class="btn-ico" aria-hidden="true">
        <!-- Lucide user-round icon -->
        <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 20a6 6 0 0 0-12 0"/><circle cx="12" cy="10" r="4"/></svg>
      </span><span id="openSignupLabel">Create Account</span></button>
    </div>
  </header>
  <div class="tabs" role="tablist" aria-label="Dataset Tabs">
    <button class="tab active" id="tab-dns" role="tab" aria-selected="true" aria-controls="panel-dns"><img src="public/dns.png" alt="" aria-hidden="true"/> DNS</button>
    <button class="tab" id="tab-wg" role="tab" aria-selected="false" aria-controls="panel-wg"><img src="public/wireguard.svg" alt="" aria-hidden="true"/> Wireguard Endpoint</button>
  </div>
  <div class="modal-overlay" id="accOverlay"></div>
  <div class="modal-container" id="accModal">
    <section id="account" class="account-panel" role="dialog" aria-modal="true" aria-labelledby="accTitle">
      <button class="modal-close" id="closeSignup" aria-label="Close">×</button>
      <h2 id="accTitle">User Account</h2>
      <div class="status-line" id="accStatus">Checking status...</div>
      <div class="row" id="u_balance_row" style="display:none">
        <div class="muted">Balance: <span id="u_balance_value">$0.00</span></div>
      </div>
      <div class="row" id="u_tg_row">
        <a class="tg-btn" href="tg://resolve?domain=minidnsverify_bot">Start Telegram Bot</a>
      </div>
      <div class="row" id="u_chat_row">
        <input type="number" id="u_chat_id" placeholder="Telegram chat_id" />
        <button id="u_send">Send Code</button>
      </div>
      <div class="row" id="u_otp_row" style="display:none">
        <input type="number" id="u_otp" placeholder="Enter verification code" />
        <button id="u_verify">Verify</button>
      </div>
      <div class="row" id="u_logged" style="display:none">
        <span>Logged in</span>
        <button id="u_logout">Logout</button>
      </div>
      <div class="row" id="u_id_row" style="display:none">
        <div class="muted">Your chat_id: <span id="u_id_value"></span></div>
      </div>
      <div id="u_history_wrap" style="display:none; margin-top: .75rem;">
        <div class="lbl" style="margin:.25rem 0">Your fetched addresses</div>
        <p class="muted">از طریق داشبورد حساب کاربری می‌توانید به آدرس‌های دریافت‌شده خود دسترسی داشته باشید و دوباره آن‌ها را مشاهده یا کپی کنید.</p>
        <div id="u_history" style="display:flex;flex-direction:column;gap:.5rem;"></div>
      </div>
      <small id="u_tg_hint">If you didn’t receive a message, open the Telegram bot below, press Start, then try again:
        <a href="https://t.me/minidnsverify_bot" target="_blank" rel="noopener" style="color:#7fd1ff">@minidnsverify_bot</a>
      </small>
    </section>
  </div>
  <!-- Global glassy error modal -->
  <div class="alert-overlay" id="alertOverlay"></div>
  <div class="alert-container" id="alertContainer">
    <div class="alert-card" role="dialog" aria-modal="true" aria-labelledby="alertTitle">
      <div class="hdr">
        <div class="ttl" id="alertTitle">خطا</div>
        <button class="btn-close" id="alertX">×</button>
      </div>
      <div class="msg" id="alertMsg"></div>
      <div class="actions">
        <button class="btn-close" id="alertOk">OK</button>
      </div>
    </div>
  </div>
  <!-- Address modal (for showing fetched IPs with Copy and auto-refresh on close) -->
  <div class="alert-overlay" id="addrOverlay"></div>
  <div class="alert-container" id="addrContainer">
    <div class="alert-card" role="dialog" aria-modal="true" aria-labelledby="addrTitle">
      <div class="hdr">
        <div class="ttl" id="addrTitle">آدرس‌های شما</div>
        <button class="btn-close" id="addrX">×</button>
      </div>
      <div class="msg" id="addrMsg" style="white-space: pre-wrap; direction: ltr;"></div>
      <div class="actions">
        <button id="addrCopy">Copy</button>
        <button class="btn-close" id="addrOk">OK</button>
      </div>
    </div>
  </div>
  <main id="cards"></main>
  <div class="pagination" id="pagination">
    <button class="page-btn" id="prevPage">Prev</button>
    <span class="page-info" id="pageInfo">Page 1 / 1</span>
    <button class="page-btn" id="nextPage">Next</button>
  </div>
  <script>
    // --- Error modal helper ---
    (function(){
      const overlay = document.getElementById('alertOverlay');
      const container = document.getElementById('alertContainer');
      const titleEl = document.getElementById('alertTitle');
      const msgEl = document.getElementById('alertMsg');
      const okBtn = document.getElementById('alertOk');
      const xBtn = document.getElementById('alertX');
      function close(){ overlay.classList.remove('active'); container.classList.remove('active'); }
      function showError(message, title){
        titleEl.textContent = title || 'خطا';
        msgEl.textContent = message || '';
        overlay.classList.add('active');
        container.classList.add('active');
      }
      okBtn.addEventListener('click', close);
      xBtn.addEventListener('click', close);
      overlay.addEventListener('click', close);
      window.showError = showError;
    })();
    // --- Address modal helper ---
    (function(){
      const overlay = document.getElementById('addrOverlay');
      const container = document.getElementById('addrContainer');
      const msgEl = document.getElementById('addrMsg');
      const copyBtn = document.getElementById('addrCopy');
      const okBtn = document.getElementById('addrOk');
      const xBtn = document.getElementById('addrX');

      function close(){
        overlay.classList.remove('active');
        container.classList.remove('active');
        // Refresh page so the assigned IPs move to busy list
        location.reload();
      }
      function showAddressModal(addresses){
        const text = (addresses||[]).join('\n');
        msgEl.textContent = text;
        overlay.classList.add('active');
        container.classList.add('active');
        // Handlers
        copyBtn.onclick = async ()=>{
          try{ await navigator.clipboard.writeText(text); copyBtn.textContent='Copied!'; setTimeout(()=>copyBtn.textContent='Copy',1500);}catch(_e){}
        };
        okBtn.onclick = close;
        xBtn.onclick = close;
        overlay.onclick = close;
      }
      window.showAddressModal = showAddressModal;
    })();
    // simple mapper to Persian names
    function nameToFa(name){
      const map = {
        'england': 'انگلیس',
        'united kingdom': 'بریتانیا',
        'uk': 'بریتانیا',
        'great britain': 'بریتانیا'
      };
      const key = String(name||'').toLowerCase();
      return map[key] || '';
    }
    const isLocal = /^(localhost|127\.0\.0\.1)/.test(location.hostname);
    // Tab and pagination state
    const pageSize = 14;
    const state = {
      currentTab: 'dns',
      page: { dns: 1, wg: 1 },
      data: { dns: [], wg: [] }
    };

    async function fetchDataset(kind){
      try{
        // Try dynamic endpoints first for DNS; for WG keep static for now
        if(kind==='dns'){
          try{
            const r = await fetch('/countries');
            if(r.ok) return await r.json();
          }catch(_){/* fallthrough */}
          const rl = await fetch('public/countries.json');
          return await rl.json();
        } else {
          try{
            const r2 = await fetch('/wireguard-countries');
            if(r2.ok) return await r2.json();
          }catch(_){/* fallthrough */}
          const rl2 = await fetch('public/wireguard-countries.json');
          return await rl2.json();
        }
      }catch(e){ return []; }
    }

    function renderPage(){
      const list = state.data[state.currentTab] || [];
      const totalPages = Math.max(1, Math.ceil(list.length / pageSize));
      let page = state.page[state.currentTab] || 1;
      if(page>totalPages) page = totalPages; if(page<1) page = 1; state.page[state.currentTab]=page;

      const start = (page-1)*pageSize;
      const slice = list.slice(start, start + pageSize);
      const container = document.getElementById('cards');
      container.innerHTML = '';

      slice.forEach(c => {
        const card = document.createElement('div');
        card.className = 'glass-card';
        const code = String((c && c.code) || '').toLowerCase() || 'gb';
        const img = new Image();
        img.alt = `${c.name} flag`;
        img.loading = 'lazy';
        img.src = `https://flagcdn.com/w160/${code}.png`;
        img.srcset = `https://flagcdn.com/w320/${code}.png 2x`;
        img.referrerPolicy = 'no-referrer';
        img.className = 'flag-img';
        card.appendChild(img);

        const title = document.createElement('h2');
        title.textContent = c.name || '';
        card.appendChild(title);
        const sub = document.createElement('div');
        sub.className = 'subtitle-fa';
        sub.textContent = c.faName || nameToFa(c.name) || '';
        if (sub.textContent) card.appendChild(sub);

        const counters = document.createElement('div');
        counters.className = 'counters';
        counters.innerHTML = `
            <div class="count total"><div class="num">0</div><div class="lbl-en">Total IPs</div></div>
            <div class="count free"><div class="num">0</div><div class="lbl-en">Free</div></div>
            <div class="count busy"><div class="num">0</div><div class="lbl-en">Busy</div></div>`;
        card.appendChild(counters);

        const btn = document.createElement('button');
        btn.className = 'get-btn';
        btn.textContent = state.currentTab==='dns' ? 'Get Addresses' : 'Get Endpoints';
        btn.addEventListener('click', async ()=>{
          const session = localStorage.getItem('userSession');
          if(!session){
            if (window.openSignupModal) window.openSignupModal();
            else window.showError('Please verify your account first.');
            return;
          }
          try{
            const path = state.currentTab==='dns' ? `/addresses/${(c.name||'').toLowerCase()}` : `/wg/${(c.name||'').toLowerCase()}`;
            const r = await fetch(path, { headers:{ 'Authorization': `Bearer ${session}` } });
            if(!r.ok){
              if(r.status===401||r.status===403){
                window.showError('Your session is invalid or unverified. Please verify again.');
              } else {
                window.showError('Failed to fetch addresses');
              }
              return;
            }
            const { addresses=[] } = await r.json();
            if(addresses.length===0){ window.showError('No addresses available yet.'); return; }
            if(window.showAddressModal) window.showAddressModal(addresses);
            try{
              const key = 'userAddrHistory';
              const hist = JSON.parse(localStorage.getItem(key) || '[]');
              const entry = { country: c.name, count: addresses.length, addresses, ts: Date.now(), type: state.currentTab };
              hist.unshift(entry);
              localStorage.setItem(key, JSON.stringify(hist.slice(0,20)));
              if(window.renderUserHistory) window.renderUserHistory();
            }catch(_e){}
          }catch(e){ console.error(e); window.showError('Network error while fetching addresses'); }
        });
        card.appendChild(btn);

        container.appendChild(card);

        // stats per country (skip local)
        async function loadStats(){
          try{
            if(isLocal) return;
            const endpoint = state.currentTab==='dns' ? `/stats/${c.name}` : `/wg-stats/${c.name}`;
            const r=await fetch(endpoint);
            if(r.ok){
              const s=await r.json();
              card.querySelector('.total .num').textContent=s.total;
              card.querySelector('.free .num').textContent=s.free;
              card.querySelector('.busy .num').textContent=s.busy;
            }
          }catch(e){}
        }
        loadStats();
        if(!isLocal) setInterval(loadStats,30000);
      });

      // update pagination UI
      const prev = document.getElementById('prevPage');
      const next = document.getElementById('nextPage');
      const info = document.getElementById('pageInfo');
      if(prev&&next&&info){
        info.textContent = `Page ${page} / ${totalPages}`;
        prev.disabled = page<=1;
        next.disabled = page>=totalPages;
      }
    }

    async function initDatasets(){
      state.data.dns = await fetchDataset('dns');
      try{ state.data.wg = await fetchDataset('wg'); }catch(_){ state.data.wg = []; }
      renderPage();
    }
    initDatasets();
    // --- User account logic ---
    (function(){
      const isLocal = /^(localhost|127\.0\.0\.1)/.test(location.hostname);
      const statusEl = document.getElementById('accStatus');
      const balRow = document.getElementById('u_balance_row');
      const balVal = document.getElementById('u_balance_value');
      const chatEl = document.getElementById('u_chat_id');
      const sendBtn = document.getElementById('u_send');
      const otpRow = document.getElementById('u_otp_row');
      const otpEl = document.getElementById('u_otp');
      const verifyBtn = document.getElementById('u_verify');
      const loggedRow = document.getElementById('u_logged');
      const logoutBtn = document.getElementById('u_logout');
      const histWrap = document.getElementById('u_history_wrap');
      const histList = document.getElementById('u_history');
      const openBtn = document.getElementById('openSignup');
      const openLabel = document.getElementById('openSignupLabel');
      const tgRow = document.getElementById('u_tg_row');
      const chatRow = document.getElementById('u_chat_row');
      const tgHint = document.getElementById('u_tg_hint');
      const idRow = document.getElementById('u_id_row');
      const idVal = document.getElementById('u_id_value');

      async function loadMe(session){
        if(!session) return;
        try{
          const r = await fetch('/auth/me', { headers:{ 'Authorization': `Bearer ${session}` } });
          if(r.ok){
            const { chat_id } = await r.json();
            if(idVal) idVal.textContent = chat_id || '';
          } else {
            if(idVal) idVal.textContent = '';
          }
        }catch(_){ if(idVal) idVal.textContent=''; }
        // Load balance
        try{
          const rb = await fetch('/user/balance', { headers:{ 'Authorization': `Bearer ${session}` } });
          if(rb.ok){
            const { balance } = await rb.json();
            if(balVal) balVal.textContent = `$${balance}`;
            if(balRow) balRow.style.display='flex';
          } else {
            if(balRow) balRow.style.display='none';
          }
        }catch(_e){ if(balRow) balRow.style.display='none'; }
      }

      async function renderLogged(){
        const ses = localStorage.getItem('userSession');
        if(ses){
          loggedRow.style.display='flex';
          otpRow.style.display='none';
          histWrap.style.display='block';
          if(openLabel){ openLabel.textContent = 'Dashboard'; }
          // hide onboarding rows when logged in
          if(tgRow) tgRow.style.display='none';
          if(chatRow) chatRow.style.display='none';
          if(tgHint) tgHint.style.display='none';
          if(idRow) idRow.style.display='flex';
          await loadMe(ses);
        } else {
          loggedRow.style.display='none';
          histWrap.style.display='none';
          if(openLabel){ openLabel.textContent = 'Create Account'; }
          // show onboarding rows when logged out
          if(tgRow) tgRow.style.display='flex';
          if(chatRow) chatRow.style.display='flex';
          if(tgHint) tgHint.style.display='block';
          if(idRow) idRow.style.display='none';
          if(idVal) idVal.textContent = '';
          if(balRow) balRow.style.display='none';
        }
      }

      (async()=>{
        try{
          if(isLocal){
            statusEl.textContent = 'Local mode';
            statusEl.style.color = '#ffd27a';
          } else {
            const r = await fetch('/status');
            if(r.ok){
              const {kv, bot} = await r.json();
              statusEl.textContent = `KV: ${kv? 'Connected':'Not available'} | Bot token: ${bot? 'Configured':'Missing'}`;
              statusEl.style.color = kv && bot ? '#9cff9c' : '#ffd27a';
            } else {
              statusEl.textContent = 'Unable to read status endpoint';
              statusEl.style.color = '#ffd27a';
            }
          }
        }catch(e){
          statusEl.textContent = 'Status check failed';
          statusEl.style.color = '#ffd27a';
        }
        renderLogged();
      })();

      // Prefill chat id from localStorage
      chatEl.value = localStorage.getItem('userChatId') || '';

      sendBtn.addEventListener('click', async (e)=>{
        e.preventDefault();
        const chat_id = chatEl.value.trim();
        if(!chat_id) return window.showError('Enter chat_id');
        localStorage.setItem('userChatId', chat_id);
        if(isLocal){
          window.showError('In local mode, sending the code may not work. Please test again after deployment.');
        }
        try{
          const r = await fetch('/auth/send-code',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({chat_id})});
            if(r.ok){
              const {next_retry_sec=30} = await r.json().catch(()=>({}));
              otpRow.style.display='flex';
              verifyBtn.style.display='inline-block';
              sendBtn.disabled = true; let left = next_retry_sec||30; const original = sendBtn.getAttribute('data-original-label') || sendBtn.textContent || 'Send Code';
              const t = setInterval(()=>{ left--; if(left<=0){clearInterval(t); sendBtn.disabled=false; sendBtn.textContent=original;} else { sendBtn.textContent=`${original} (${left} seconds left)`; } },1000);
            } else {
            const j = await r.json().catch(()=>({}));
            if(r.status===429 && j.next_retry_sec){
              window.showError(`Please wait ${j.next_retry_sec} seconds.`, 'لطفاً صبر کنید');
              } else {
              window.showError('Error sending code');
              }
            }
        }catch(e){ window.showError('Network error'); }
      });

      verifyBtn.addEventListener('click', async (e)=>{
        const chat_id = chatEl.value.trim();
        const code = otpEl.value.trim();
        if(!code) { window.showError('Enter code'); return; }
        try{
          const r = await fetch('/auth/verify',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({chat_id,code})});
          if(r.ok){
            const {session} = await r.json();
            localStorage.setItem('userSession', session);
            alert('Your account has been verified.');
            await renderLogged();
          } else {
            window.showError('Verification failed');
          }
        }catch(e){ window.showError('Network error'); }
      });

      // style logout button and add confirmation
      logoutBtn.classList.add('danger-btn');
      logoutBtn.addEventListener('click', async ()=>{
        if(confirm('آیا از خروج از حساب اطمینان دارید؟')){
          localStorage.removeItem('userSession');
          await renderLogged();
        }
      });

      // Render user address history
      window.renderUserHistory = async function(){
        try{
          const arr = JSON.parse(localStorage.getItem('userAddrHistory') || '[]');
          histList.innerHTML = '';
          if(arr.length===0){
            const p = document.createElement('div');
            p.className = 'muted';
            p.textContent = 'No addresses fetched yet.';
            histList.appendChild(p);
            return;
          }
          for(const item of arr){
            const row = document.createElement('div');
            row.className = 'hist-row';
            const header = document.createElement('div');
            header.className = 'hist-header';
            header.textContent = `${item.country} — ${item.count} IPs`;
            const actions = document.createElement('div');
            const copy = document.createElement('button');
            copy.textContent = 'Copy';
            copy.addEventListener('click', async ()=>{
              try{ await navigator.clipboard.writeText((item.addresses||[]).join('\n')); }catch(_e){}
            });
            actions.appendChild(copy);
            const top = document.createElement('div');
            top.className = 'hist-top';
            top.appendChild(header);
            top.appendChild(actions);
            row.appendChild(top);

            // Geolocate up to first 8 IPs from this entry
            const ips = (item.addresses||[]).slice(0,8);
            if(ips.length){
              try{
                const r = await fetch('/geo', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ ips }) });
                if(r.ok){
                  const { results=[] } = await r.json();
                  const list = document.createElement('div');
                  list.className = 'hist-geo-list';
                  for(const g of results){
                    const card = document.createElement('div');
                    card.className = 'hist-geo-card';
                    const ip = document.createElement('div'); ip.className = 'geo-ip'; ip.textContent = g.query || '';
                    const meta = document.createElement('div'); meta.className = 'geo-meta';
                    const parts = [];
                    if(g.countryCode){ parts.push(g.countryCode); }
                    if(g.city){ parts.push(g.city); }
                    if(g.isp){ parts.push(g.isp); }
                    meta.textContent = parts.join(' • ');
                    card.appendChild(ip);
                    card.appendChild(meta);
                    list.appendChild(card);
                  }
                  row.appendChild(list);
                }
              }catch(_e){}
            }
            histList.appendChild(row);
          }
        }catch(e){ histList.innerHTML=''; }
      }
    })();

    // --- Modal open/close for account panel ---
    (function(){
      const openBtn = document.getElementById('openSignup');
      const overlay = document.getElementById('accOverlay');
      const modal = document.getElementById('accModal');
      const closeBtn = document.getElementById('closeSignup');

      function open(){ overlay.classList.add('active'); modal.classList.add('active'); if(window.renderUserHistory) window.renderUserHistory(); }
      function close(){ overlay.classList.remove('active'); modal.classList.remove('active'); }
      window.openSignupModal = open;
      window.closeSignupModal = close;

      if(openBtn) openBtn.addEventListener('click', open);
      if(closeBtn) closeBtn.addEventListener('click', close);
      if(overlay) overlay.addEventListener('click', close);
      document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') close(); });
    })();
    // Tabs & Pagination wiring
    (function(){
      const tabDns = document.getElementById('tab-dns');
      const tabWg = document.getElementById('tab-wg');
      const prev = document.getElementById('prevPage');
      const next = document.getElementById('nextPage');
      function setActive(tab){
        state.currentTab = tab;
        if(tabDns&&tabWg){
          if(tab==='dns'){ tabDns.classList.add('active'); tabDns.setAttribute('aria-selected','true'); tabWg.classList.remove('active'); tabWg.setAttribute('aria-selected','false'); }
          else { tabWg.classList.add('active'); tabWg.setAttribute('aria-selected','true'); tabDns.classList.remove('active'); tabDns.setAttribute('aria-selected','false'); }
        }
        renderPage();
      }
      if(tabDns) tabDns.addEventListener('click',()=> setActive('dns'));
      if(tabWg) tabWg.addEventListener('click',()=> setActive('wg'));
      if(prev) prev.addEventListener('click',()=>{ state.page[state.currentTab] = Math.max(1,(state.page[state.currentTab]||1)-1); renderPage(); });
      if(next) next.addEventListener('click',()=>{ const list = state.data[state.currentTab]||[]; const total = Math.max(1, Math.ceil(list.length/pageSize)); state.page[state.currentTab] = Math.min(total,(state.page[state.currentTab]||1)+1); renderPage(); });
    })();
    </script>
  <script src="public/net.js"></script>
</body>
</html>
